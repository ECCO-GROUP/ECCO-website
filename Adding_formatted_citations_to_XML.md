## How to add formatted citations to the publiations XML file 
by Ian Fenty

The ECCO website has a javascript code, *publications.js*, that runs whenever someone goes to the ECCO 'publications' page.  That javascript code parses an XML file and makes the nice table and the 'pop-up' windows with more detailed publication information that are created when a publication is clicked on.  

Formerly, the XML file contained a field called 'notes' which had the formatted citation as a string.  Every time we added a citation, we had to create the formatted citation and paste it as a string in the 'notes' field.  Now, we automatically generate the formatted citation string using information stored in the XML file.  The formatted citation strings are added to each publication record of the XML file in fields called 'formatted-citation'.

Our publication XML files are first generated by exporting the ECCO publication database on Mendeley. Exportig the database to an XML file does not create the 'formatted-citation' field.  To create the 'formatted-citation' field, we have to run a python program that takes the publication XML file as an input and creates two new files as output.  The first output file is an XML file with 'formatted-citation' fields.  This file must be named 'collection.xml' to be read by the javascript code.  The second file contains the same information as the first except it is formatted to be human readable (file suffix '-pretty').

Here are the instructions for taking the XML file from Mendeley and adding the 'formatted-citation' field:

### Generate the XML file from the Mendeley Database
**Step 1**, In the Mendeley Database, select all of the publications that you want to export

**Step 2**, Go to File/Export then Select "Endnote XML" as export format

**Step 3**, Save the file somewhere with a name like *ECCO-PUBLICATIONS-YYYY-MM-DD.XML*


### Add Formatted Citations to the XML file
**Step 1**, Go the directory with the *ECCO-PUBLICATIONS-YYYY-MM-DD.XML* file

**Step 2**, run the Python program on the XML file
```
python /ECCO-WEBSITE/assets/code/parse_bibliography_xml_to_formatted_citation.py ECCO-PUBLICATIONS-YYYY-MM-DD.XML ECCO-PUBLICATIONS-YYYY-MM-DD-with-references.xml
```

### Replace the Old Publication XML File
**Step 1**, Copy *ECCO-PUBLICATIONS-YYYY-MM-DD-with-references.xml* to */ECCO-WEBSITE/assets/data/*

**Step 2**, Delete the old publication XML file
```
rm /ECCO-WEBSITE/assets/data/collection.xml 
```

**Step 3**, Copy *ECCO-PUBLICATIONS-YYYY-MM-DD-with-references.xml* as */ECCO-WEBSITE/assets/data/collection.xml*

**Step 4**, Add *ECCO-PUBLICATIONS-YYYY-MM-DD-with-references.xml* and the new *collection.xml* to the repository
```
git add /ECCO-WEBSITE/assets/data/ECCO-PUBLICATIONS-YYYY-MM-DD-with-references.xml
git add /ECCO-WEBSITE/assets/data/collection.xml
```

**Step 5**, commit the changes to the ECCO-GROUP website Github 
```
git commit -m "added new publications file"
git push origin master
```
